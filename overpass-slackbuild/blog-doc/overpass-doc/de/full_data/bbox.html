<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml">
<head><meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
pre { background-color:#ccffff; padding: 0.5em; counter-reset: line; }
div[type=sibling] { text-indent:1em; }
codeline::before { counter-increment: line; content: counter(line)" "; color: #99cccc; }
</style>
  <title>Bounding-Boxen</title>
</head>
<body style="font-family:sans-serif; max-width:32em">

<p><a href="../index.html">Handbuch zur Overpass API</a>  </p>

<nav>
<div type="parent"><a href="../preface/index.html">Einführung</a></div>
<div type="parent"><a href="../targets/index.html">Verwendung</a></div>
<div type="parent"><strong><a href="index.html">Räumliche Datenauswahl</a></strong></div>

<div type="sibling"><strong> Bounding-Boxen</strong></div>
<div type="sibling"><a href="osm_types.html">Geometrien</a></div>
<div type="sibling"><a href="map_apis.html">Weitere Map-APIs</a></div>
<div type="sibling"><a href="polygon.html">Polygon und Around</a></div>
<div type="sibling"><a href="area.html">Suche per Area</a></div>
<div type="sibling"><a href="other_sources.html">Alternativen</a></div>

</nav>
<div type="parent"><a href="../criteria/index.html">Objekte Finden</a></div>
<div type="parent"><a href="../counting/index.html">Objekte Zählen</a></div>
<div type="parent"><a href="../analysis/index.html">Daten Analysieren</a></div>
<div type="parent"><a href="../more_info/index.html">Anhang</a></div>

<hr />

<h1>Bounding-Boxen</h1>

<p>Der einfachste Weg, um an OpenStreetMap-Daten in einem Ausschnitt zu kommen.</p>

<nav>
<h3>Inhalt</h3>

<div type="subsection"><a href="bbox.html#filter">Suchkriterium</a></div>
<div type="subsection"><a href="bbox.html#crop">Ausgabebegrenzung</a></div>
<div type="subsection"><a href="bbox.html#global">Globale Bounding-Box</a></div>

</nav>

<p><a name="filter"/></p>

<h2>Suchkriterium</h2>

<p>Der einfachste Weg, an alle Daten in einer Bounding-Box zu kommen, ist,
dies explizit so zu formulieren <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.4775&amp;lon=0.0&amp;zoom=16&amp;Q=nwr%2851%2E477%2C%2D0%2E001%2C51%2E478%2C0%2E001%29%3B%0Aout%3B">(Link)</a>:</p>

<pre>
<codeline>nwr(51.477,-0.001,51.478,0.001);</codeline>
<codeline>out;</codeline>
</pre>

<p>Dabei steht <code>(51.477,-0.001,51.478,0.001)</code> für die Bounding Box.
Die Reihenfolge der Ränder im Ausdruck ist dabei immer gleich:</p>

<ul>
<li><code>51.477</code> ist der Breitengrad (<em>Latitude</em>) des südlichen Randes</li>
<li><code>-0.001</code> ist der Längengrad (<em>Longitude</em>) des westlichen Randes</li>
<li><code>51.478</code> ist der Breitengrad (<em>Latitude</em>) des nördlichen Randes</li>
<li><code>0.001</code> ist der Längengrad (<em>Longitude</em>) des östlichen Randes</li>
</ul>

<p>Die Overpass API verwendet ausschließlich Dezimalbrüche,
die Minuten-Sekunden-Notation oder Minuten-Dezimalbruch-Notation wird nicht unterstützt.</p>

<p>Der Wert für den südlichen Rand muss stets kleiner sein als der Wert für den nördlichen Rand,
da im Breitengrad-Längengrad-Koordinatensystem die Grade vom Südpol zum Nordpol wachsen, von -90.0 bis +90.0.</p>

<p>Im Gegensatz dazu steigen die Längengrade zwar von Westen nach Osten ebenfalls fast überall an.
Es gibt aber den sogenannten Antimeridian, im Deutschen oft mit der "Datumsgrenze" verwechselt;
dort springt der Wert von +180.0 auf -180.0.
Er verläuft zwischen Nordpol und Südpol durch den Pazifik.
In nahezu allen Fällen ist also ebenfalls der westliche Wert kleiner als der östliche Wert,
es sei denn, man will eine Bounding-Box über den Antimeridian spannen.</p>

<p>Meistens ist es recht mühsam,
die passende Bounding-Box selbst herauszufinden.
Daher haben fast alle der unter <a href="../targets/index.html">Verwendung</a> beschriebenen Programme Komfortfunktionen dafür.
Bei <a href="../targets/turbo.html#convenience">Overpass Turbo</a> und auch <a href="../targets/index.html">JOSM</a>
werden vor dem Absenden der Anfrage alle Vorkommen der Zeichenfolge <code>{{bbox}}</code> durch die sichtbare Bounding-Box ersetzt. Damit kann man eine Abfrage wie oben allgemeiner schreiben als <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.4775&amp;lon=0.0&amp;zoom=16&amp;Q=nwr%28%7B%7Bbbox%7D%7D%29%3B%0Aout%3B">(Link)</a></p>

<pre>
<codeline>nwr({{bbox}});</codeline>
<codeline>out;</codeline>
</pre>

<p>Die Abfrage wirkt dann in der jeweils sichtbaren Bounding-Box.</p>

<p>Beachten Sie, dass einige Elemente in der Darstellung gestrichelt werden.
Das ist der Hinweis auf ein größere Problematik, dem wir <a href="osm_types.html">im nächsten Abschnitt</a> nachgehen werden:
Es werden zwar formal vollständige Objekte geliefert,
aber diese Objekte haben hier unvollständige Geometrien,
da wir dies in der Abfrage so spezifiziert haben.</p>

<p><a name="crop"/></p>

<h2>Ausgabebegrenzung</h2>

<p>Eine zweite Situation, in der Bounding-Boxen vorkommen,
ist bei der Ausgabebegrenzung mit <code>out geom</code>.
Möchte man einen <em>Way</em> oder eine <em>Relation</em> auf der Karte visualisieren,
so muss die Overpass API <a href="../targets/formats.html#extras">explizit anweisen</a>,
das Objekt entgegen der OSM-Konventionen mit Koordinaten auszustatten.</p>

<p>Im Falle von Relationen kann dies zu großen Datenmengen führen.
So wird in <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.4775&amp;lon=0.0&amp;zoom=16&amp;Q=relation%2851%2E477%2C%2D0%2E001%2C51%2E478%2C0%2E001%29%3B%0Aout%20geom%3B">diesem Beispiel</a> ungefragt Geometrie quer durch England ausgeliefert,
obwohl nur ein paar hundert Quadratmeter im Fokus gewesen sind:</p>

<pre>
<codeline>relation(51.477,-0.001,51.478,0.001);</codeline>
<codeline>out geom;</codeline>
</pre>

<p>Die Datenmenge kann eingeschränkt werden,
indem bei der Ausgabe <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.4775&amp;lon=0.0&amp;zoom=16&amp;Q=relation%2851%2E477%2C%2D0%2E001%2C51%2E478%2C0%2E001%29%3B%0Aout%20geom%2851%2E47%2C%2D0%2E01%2C51%2E49%2C0%2E01%29%3B">explizit</a> nur Koordinaten aus einer übergebenen Bounding-Box angefordert werden:</p>

<pre>
<codeline>relation(51.477,-0.001,51.478,0.001);</codeline>
<codeline>out geom(51.47,-0.01,51.49,0.01);</codeline>
</pre>

<p>Die Bounding-Box wird direkt hinter <code>geom</code> notiert.
Sie kann sowohl gleich als auch verschieden von Bounding-Boxen aus vorangehenden Statements sein.
In diesem Fall haben wir uns durch verschiedene Bounding-Boxen zu einem sehr breiten Reserverand entschieden.</p>

<p>Zu explizit vorkommenden <em>Nodes</em> werden dabei die Koordinaten genau dann mitgeliefert,
wenn diese innerhalb der Bounding-Box liegen.</p>

<p>Bei <em>Ways</em> nicht nur die Koordinaten aller <em>Nodes</em> in der Bounding-Box mitgeliefert,
sondern auch die jeweils nächste und vorausgehende Koordinate,
auch wenn sie bereits außerhalb der Bounding-Box liegt.
Um dies <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.4775&amp;lon=0.0&amp;zoom=18&amp;Q=way%5Bname%3D%22Blackheath%20Avenue%22%5D%2851%2E477%2C%2D0%2E001%2C51%2E478%2C0%2E001%29%3B%0Aout%20geom%2851%2E477%2C%2D0%2E002%2C51%2E479%2C0%2E002%29%3B">im Beispiel</a> zu sehen, bitte nach dem Ausführen auf <em>Daten</em> oben rechts klicken;
Herumschieben der Karte zeigt auch, wo abgeschnitten worden ist:</p>

<pre>
<codeline>way[name="Blackheath Avenue"](51.477,-0.001,51.478,0.001);</codeline>
<codeline>out geom(51.477,-0.002,51.479,0.002);</codeline>
</pre>

<p>Nur ein Teil der <em>Nodes</em> im <em>Way</em> hat hier Koordinaten.</p>

<p>Die mit Koordinaten versehenen Abschnitte des Ways <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.4735&amp;lon=-0.007&amp;zoom=17&amp;Q=way%5Bname%3D%22Hyde%20Vale%22%5D%3B%0Aout%20geom%2851%2E472%2C%2D0%2E009%2C51%2E475%2C%2D0%2E005%29%3B">können unzusammenhängend</a> sein,
auch bei einem einzelnen Way:</p>

<pre>
<codeline>way[name="Hyde Vale"];</codeline>
<codeline>out geom(51.472,-0.009,51.475,-0.005);</codeline>
</pre>

<p>Es reicht dazu eine mäßige Kurve aus der Bounding-Box und wieder hinein wie in diesem Beispiel.</p>

<p>Bei <em>Relations</em> werden <em>Member</em> vom Typ <em>Way</em> expandiert,
wenn zumindest eine der <em>Nodes</em> dieses Ways innerhalb der Bounding-Box liegt.
Andere <em>Member</em> vom Typ <em>Way</em> werden nicht expandiert.
Innerhalb dieser <em>Ways</em> werden wie bei einzelnen <em>Ways</em> die <em>Nodes</em> innerhalb der Bounding Box plus eine Extra-<em>Node</em> mit Koordinaten versehen.</p>

<p>Ebenso wie bei der Bounding-Box als Filter haben die meisten Programme einen Mechanismus,
um die Bounding Box selbsttätig einzufügen.
Bei <a href="../targets/turbo.html#convenience">Overpass Turbo</a> tut dies wie oben <code>{{bbox}}</code>, <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.4775&amp;lon=0.0&amp;zoom=16&amp;Q=relation%28%7B%7Bbbox%7D%7D%29%3B%0Aout%20geom%28%7B%7Bbbox%7D%7D%29%3B">(Beispiel)</a>:</p>

<pre>
<codeline>relation({{bbox}});</codeline>
<codeline>out geom({{bbox}});</codeline>
</pre>

<p><a name="global"/></p>

<h2>Globale Bounding-Box</h2>

<p>...</p>
<hr/>
<p>weiter: <a href="osm_types.html">Geometrien</a></p>

</body>
</html>
