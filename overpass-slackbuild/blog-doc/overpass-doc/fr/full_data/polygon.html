<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml">
<head><meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
pre { background-color:#ccffff; padding: 0.5em; counter-reset: line; }
div[type=sibling] { text-indent:1em; }
codeline::before { counter-increment: line; content: counter(line)" "; color: #99cccc; }
</style>
  <title>Polygone et autour</title>
</head>
<body style="font-family:sans-serif; max-width:32em">

<p><a href="../index.html">Mode d'emploi d'API Overpass</a>  </p>

<nav>
<div type="parent"><a href="../preface/index.html">Introduction</a></div>
<div type="parent"><a href="../targets/index.html">Utilisation</a></div>
<div type="parent"><strong><a href="index.html">Toutes les données dans une région</a></strong></div>

<div type="sibling"><a href="bbox.html">Rectangle englobant</a></div>
<div type="sibling"><a href="osm_types.html">Des géométries</a></div>
<div type="sibling"><a href="map_apis.html">Autres APIs disponibles</a></div>
<div type="sibling"><strong> Polygone et autour</strong></div>
<div type="sibling"><a href="area.html">Requêter par surface</a></div>
<div type="sibling"><a href="other_sources.html">Alternatives</a></div>

</nav>
<div type="parent"><a href="../criteria/index.html">Trouver des objets</a></div>
<div type="parent"><a href="../counting/index.html">Compter d'objets</a></div>
<div type="parent"><a href="../analysis/index.html">Analyser des données</a></div>
<div type="parent"><a href="../more_info/index.html">Plus d'informations</a></div>

<hr />

<h1>Polygone et autour</h1>

<p>En plus de le rectangle englobant, il existe d'autres cadres de délimitation qui sont plus adaptables à la zone cible.</p>

<p>Les coordonnées en latitude et en longitude sont bien compréhensibles en tant que concept,
mais très peu de gens connaissent les coordonnées des lieux qui les intéressent par cœur.</p>

<p>C'est pourquoi la recherche indirecte au moyen d'objets nommés est introduite en premier lieu.
D'une part, la recherche dans les surfaces est extrêmement fréquente,
mais d'un autre côté, il a plusieurs particularités.
Il est donc traité dans un <a href="area.html">autre sous-chapitre</a>.</p>

<p>Le premier sous-chapitre traite de la recherche à proximité des objets nommés.
La recherche au voisinage des coordonnées suit.
Enfin, les polygones sont introduits comme filtres de recherche spatiale.</p>

<nav>
<h3>Sommaire</h3>

<div type="subsection"><a href="polygon.html#around">Autour des objets</a></div>
<div type="subsection"><a href="polygon.html#absolute_around">Autour des coordonnées</a></div>
<div type="subsection"><a href="polygon.html#polygon">Par polygone saisi</a></div>

</nav>

<p><a name="around"/></p>

<h2>Autour des objets</h2>

<p>C'est une tâche exigeante,
pour déterminer de manière fiable un lieu concret à partir d'un texte.
C'est donc également vraiment pour un géocodeur, par exemple <a href="../criteria/nominatim.html#nominatim">Nominatim</a>,
et n'est pas approfondi ici.
Avec les résultats de Nominatim, la recherche de coordonnées décrite dans la section suivante peut déjà être utilisée.</p>

<p>Cependant, il y a suffisamment d'exemples où le nom <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.0&amp;lon=10.0&amp;zoom=6&amp;Q=nwr%5Bname%3D%22K%C3%B6lner%20Dom%22%5D%3B%0Aout%20geom%3B">fournit</a> déjà l'objet juste:</p>

<pre>
<codeline>nwr[name="Kölner Dom"];</codeline>
<codeline>out geom;</codeline>
</pre>

<p>Dans la ligne 1, nous recherchons tous les objets,
qui ont un tag <code>nom</code> avec la valeur <code>Kölner Dom</code>.
Ceci est stocké dans l'ensemble <code>_</code>,
et à la ligne 2 <code>out geom</code> affiche ce qu'il trouve dans l'ensemble <code>_</code>.</p>

<p>Pour rappel: <a href="../targets/turbo.html#basics">La loupe</a> zoome sur les lieux.
En particulier avec les filtres indirects, il est souvent judicieux d'exécuter la recherche d'objet d'origine,
pour exclure qu'il existe d'autres objets du même nom <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.0&amp;lon=10.0&amp;zoom=6&amp;Q=nwr%5Bname%3D%22Viktualienmarkt%22%5D%3B%0Aout%20geom%3B">dans d'autres lieux</a>:</p>

<pre>
<codeline>nwr[name="Viktualienmarkt"];</codeline>
<codeline>out geom;</codeline>
</pre>

<p>Un <a href="bbox.html#filter">rectangle englobant</a> ou la spécification d'une surface enfermemente <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=48.0&amp;lon=11.5&amp;zoom=10&amp;Q=area%5Bname%3D%22M%C3%BCnchen%22%5D%3B%0Anwr%28area%29%5Bname%3D%22Viktualienmarkt%22%5D%3B%0Aout%20geom%3B">peut aider</a>:</p>

<pre>
<codeline>area[name="München"];</codeline>
<codeline>nwr(area)[name="Viktualienmarkt"];</codeline>
<codeline>out geom;</codeline>
</pre>

<p>Les objets désirés sont listés ici après la ligne 2 dans l'ensemble <code>_</code>.</p>

<p>Nous pouvions maintenant <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=50.94&amp;lon=6.96&amp;zoom=14&amp;Q=nwr%5Bname%3D%22K%C3%B6lner%20Dom%22%5D%3B%0Anwr%28around%3A100%29%3B%0Aout%20geom%3B">trouver</a> tous les objets dans un rayon de 100 mètres autour de la cathédrale de Cologne:</p>

<pre>
<codeline>nwr[name="Kölner Dom"];</codeline>
<codeline>nwr(around:100);</codeline>
<codeline>out geom;</codeline>
</pre>

<p>Cependant, Overpass Turbo prévient à juste titre de la grandeur de la quantité de données qui reviennent.
Il ne s'ouvre pas tout de suite non plus,
pourquoi les voies entre Paris et Bruxelles doivent être considérées comme proches de la cathédrale de Cologne.
Le problème est donc encore une fois les <em>relations</em> spatialement gigantesques.
Comme ce <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=48.135&amp;lon=11.575&amp;zoom=14&amp;Q=area%5Bname%3D%22M%C3%BCnchen%22%5D%3B%0Anwr%28area%29%5Bname%3D%22Viktualienmarkt%22%5D%3B%0Anwr%28around%3A100%29%3B%0Aout%20geom%3B">n'est guère mieux</a> au Viktualienmarkt à cause des sentiers de randonnée et de vélo de longue distance ...</p>

<pre>
<codeline>area[name="München"];</codeline>
<codeline>nwr(area)[name="Viktualienmarkt"];</codeline>
<codeline>nwr(around:100);</codeline>
<codeline>out geom;</codeline>
</pre>

<p>... on peut supposer qu'il s'agit d'un problème courant.
Ceci fixe des limites étroites à l'utilisation du filtre <em>around</em> sans filtres supplémentaires.</p>

<p>Sur la couche technique, nous avons de nouveau nos objets nommés avant la ligne 3 dans l'ensemble <code>_</code>.
L'instruction <em>around</em> filtre maintenant uniquement les objets de tous les objets,
qui ont une distance d'au moins un objet dans l'ensemble <code>_</code> d'au plus la valeur spécifiée <code>100</code> en mètres.</p>

<p>Le mécanisme de chaînage a <a href="../criteria/chaining.html#lateral">son propre sous-chapitre</a>,
et des ensembles ont été introduits dans <a href="../preface/design.html#sets">la préface</a>.
L'exemple là <a href="../preface/design.html#sequential">depuis le début</a> montre une application des filtres <em>around</em>
qui est pertinente,
parce qu'il <a href="../criteria/union.html#intersection">combine</a> le filtre avec un filtre après un attribut.
Les outils contre les ensembles de données surdimensionnés ont été discutés dans le sous-chapitre <a href="osm_types.html#full">Géométries</a>.</p>

<p>Une autre solution possible pour au moins afficher le cas ci-dessus d'une manière significative,
serait de filtrer pour <em>chemins</em> au lieu de tous les objets et de ne déterminer que les <em>relations</em>,
qui font référence aux <em>chemins</em> trouvés;
pour <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=50.94&amp;lon=6.96&amp;zoom=14&amp;Q=nwr%5Bname%3D%22K%C3%B6lner%20Dom%22%5D%3B%0Away%28around%3A100%29%3B%0Aout%20geom%3B%0Arel%28bw%29%3B%0Aout%3B">la cathédrale de Cologne</a>:</p>

<pre>
<codeline>nwr[name="Kölner Dom"];</codeline>
<codeline>way(around:100);</codeline>
<codeline>out geom;</codeline>
<codeline>rel(bw);</codeline>
<codeline>out;</codeline>
</pre>

<p>La ligne 1 met les objets nommés dans l'ensemble <code>_</code>.
La ligne 2 trouve tous les <em>chemins</em>,
qui ont une distance maximale de 100 mètres d'au moins un des objets de l'ensemble <code>_</code>;
le résultat remplace le contenu de l'ensemble <code>_</code>.
La ligne 3 affiche le contenu de l'ensemble <code>_</code>, c'est-à-dire les <em>chemins</em> de la ligne 2.
La ligne 4 trouve toutes les <em>relations</em> qui font référence à au moins une des <em>chemins</em> stockées dans l'ensemble <code>_</code>
et remplace le contenu de <code>_</code> par ce résultat.
La ligne 5 affiche le contenu de l'ensemble <code>_</code>, c'est-à-dire les <em>relations</em> trouvées,
mais contrairement à la ligne 3, aucune coordonnée n'est fournie.
cela réduit les <em>relations</em> à une taille gérable.</p>

<p><a name="absolute_around"/></p>

<h2>Autour des coordonnées</h2>

<p>Vous pouvez également effectuer une recherche dans un rayon en utilisant des coordonnées au lieu d'objets existants.
Un exemple près de Greenwich <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.477&amp;lon=0.0&amp;zoom=15&amp;Q=nwr%28around%3A100%2C51%2E477%2C0%2E0%29%3B%0Aout%20geom%3B">sur le méridien origine</a>:</p>

<pre>
<codeline>nwr(around:100,51.477,0.0);</codeline>
<codeline>out geom;</codeline>
</pre>

<p>Un filtre est utilisé dans la ligne 1:
tous les objets de l'ensemble <code>_</code> sont stockés,
qui ont une distance maximale de 100 mètres par rapport à la coordonnée donnée.
La ligne 2 affiche l'ensemble <code>_</code>.</p>

<p>Les mêmes précautions s'appliquent que pour toutes les autres recherches de données complètes avec <em>relations</em>:
très vite, vous avez beaucoup de données.
Les techniques de réduction de <a href="osm_types.html#full">rectangle englobant</a> et <a href="polygon.html#around">de la dernière section</a> s'appliquent également ici.</p>

<p>Mais il n'y a aucune obligation de chercher <em>relations</em>.
Vous pouvez également rechercher uniquement <em>nodes</em>, <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.477&amp;lon=0.0&amp;zoom=15&amp;Q=way%28around%3A100%2C51%2E477%2C0%2E0%29%3B%0Aout%20geom%3B">uniquement pour <em>chemins</em></a> ...</p>

<pre>
<codeline>way(around:100,51.477,0.0);</codeline>
<codeline>out geom;</codeline>
</pre>

<p>...ou chercher <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.477&amp;lon=0.0&amp;zoom=15&amp;Q=%28%0A%20%20node%28around%3A100%2C51%2E477%2C0%2E0%29%3B%0A%20%20way%28around%3A100%2C51%2E477%2C0%2E0%29%3B%0A%29%3B%0Aout%20geom%3B">des <em>nœuds</em> et des <em>chemins</em></a>:</p>

<pre>
<codeline>(</codeline>
<codeline>  node(around:100,51.477,0.0);</codeline>
<codeline>  way(around:100,51.477,0.0);</codeline>
<codeline>);</codeline>
<codeline>out geom;</codeline>
</pre>

<p>Ici, nous utilisons une instruction <em>union</em> (qui sera introduite <a href="../criteria/union.html#union">plus tard</a>),
pour fusionner les résultats de la recherche de rayon pour <em>nœuds</em> et de la recherche de rayon pour <em>chemins</em>.
La ligne 2 et la ligne 3 filtrent chacune un type d'objet à l'aide d'un filtre <em>around</em>,
et <em>union</em> fusionne les résultats des deux instructions dans l'ensemble <code>_</code>.</p>

<p>Cela permet de réaliser des cercles d'un rayon de 1000 mètres et plus.</p>

<p>Les relations peuvent maintenant être <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.477&amp;lon=0.0&amp;zoom=15&amp;Q=%28%0A%20%20node%28around%3A1000%2C51%2E477%2C0%2E0%29%3B%0A%20%20way%28around%3A1000%2C51%2E477%2C0%2E0%29%3B%0A%29%3B%0Aout%20geom%3B%0Arel%28%3C%29%3B%0Aout%3B">ajoutées</a> sans géométrie comme ci-dessus:</p>

<pre>
<codeline>(</codeline>
<codeline>  node(around:1000,51.477,0.0);</codeline>
<codeline>  way(around:1000,51.477,0.0);</codeline>
<codeline>);</codeline>
<codeline>out geom;</codeline>
<codeline>rel(&lt;);</codeline>
<codeline>out;</codeline>
</pre>

<p>Dans la ligne 5, le résultat de l'instruction <em>union</em> est disponible comme entrée dans l'ensemble <code>_</code>.
Le filtre <code>(&lt;)</code> n'autorise que les objets,
qui font référence à au moins un objet dans l'entrée -
ce sont exactement les relations qui ont un rapport avec la zone de recherche.</p>

<p>Pour s'occuper des recherches,
qui ne rentrent pas bien dans les rectangles englobants,
nous introduirons la recherche périmétrique autour d'une ligne polygonale.
Pour cela, vous définissez un chemin avec deux coordonnées ou plus,
et tous les objets sont trouvés,
dont <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.477&amp;lon=0.0&amp;zoom=13&amp;Q=%28%0A%20%20node%28around%3A100%2C51%2E477%2C0%2E0%2C51%2E46%2C%2D0%2E03%29%3B%0A%20%20way%28around%3A100%2C51%2E477%2C0%2E0%2C51%2E46%2C%2D0%2E03%29%3B%0A%29%3B%0Aout%20geom%3B%0Arel%28%3C%29%3B%0Aout%3B">la distance moins est inférieure</a> à la valeur spécifiée en mètres:</p>

<pre>
<codeline>(</codeline>
<codeline>  node(around:100,51.477,0.0,51.46,-0.03);</codeline>
<codeline>  way(around:100,51.477,0.0,51.46,-0.03);</codeline>
<codeline>);</codeline>
<codeline>out geom;</codeline>
<codeline>rel(&lt;);</codeline>
<codeline>out;</codeline>
</pre>

<p>Par rapport à la requête précédente, seules les lignes 2 et 3 ont changé;
les coordonnées sont séparées par des virgules.</p>

<p><a name="polygon"/></p>

<h2>Par polygone saisi</h2>

<p>Une autre méthode,
pour s'occuper des zones de recherche,
qui ne rentrent pas bien dans les rectangles englobants,
est de chercher par polygone.</p>

<p>Il est vrai que <a href="area.html">surfaces</a> couvre déjà de nombreuses applications,
en permettant la recherche dans exactement une zone nommée.
Mais quand il s'agit d'étendre ces zones ou de réduire les formes libres arbitraires,
la limite de la zone doit être passée comme un polygone explicite.</p>

<p>Pour l'illustration d'abord une recherche seulement pour les nœuds <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.477&amp;lon=0.0&amp;zoom=14&amp;Q=node%28poly%3A%2251%2E47%20%2D0%2E01%2051%2E477%200%2E01%2051%2E484%20%2D0%2E01%22%29%3B%0Aout%20geom%3B">avec un triangle comme limite</a>,
pour bien voir la forme du polygone sur la carte:</p>

<pre>
<codeline>node(poly:"51.47 -0.01 51.477 0.01 51.484 -0.01");</codeline>
<codeline>out geom;</codeline>
</pre>

<p>Dans la ligne 1, nous recherchons <em>nœudes</em>,
et le filtre <code>(poly :....)</code> n'autorise que de tels objets,
qui sont à l'intérieur du polygone noté entre guillemets.
Le polygone est une liste de coordonnées latitude-longitude,
où seuls les blancs sont autorisés entre les valeurs numériques.
Après la dernière coordonnée, l'API Overpass ajoute le segment de fermeture.</p>

<p>La <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.477&amp;lon=0.0&amp;zoom=14&amp;Q=nwr%28poly%3A%2251%2E47%20%2D0%2E01%2051%2E477%200%2E01%2051%2E484%20%2D0%2E01%22%29%3B%0Aout%20geom%3B">recherche de les trois types d'objets</a> fournit une fois de plus une très grande quantité de données:</p>

<pre>
<codeline>nwr(poly:"51.47 -0.01 51.477 0.01 51.484 -0.01");</codeline>
<codeline>out geom;</codeline>
</pre>

<p>Comme <a href="polygon.html#around">avant</a> ceci peut être contenu par les deux étapes <em>nœudes</em> plus <em>chemins</em> et résolution arrière des <em>relations</em>;
la réduction des données ne résulte que du fait
qu'aux <em>relations</em> <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.477&amp;lon=0.0&amp;zoom=14&amp;Q=%28%0A%20%20node%28poly%3A%2251%2E47%20%2D0%2E01%2051%2E477%200%2E01%2051%2E484%20%2D0%2E01%22%29%3B%0A%20%20way%28poly%3A%2251%2E47%20%2D0%2E01%2051%2E477%200%2E01%2051%2E484%20%2D0%2E01%22%29%3B%0A%29%3B%0Aout%20geom%3B%0Arel%28%3C%29%3B%0Aout%3B">la géométrie est omise</a>:</p>

<pre>
<codeline>(</codeline>
<codeline>  node(poly:"51.47 -0.01 51.477 0.01 51.484 -0.01");</codeline>
<codeline>  way(poly:"51.47 -0.01 51.477 0.01 51.484 -0.01");</codeline>
<codeline>);</codeline>
<codeline>out geom;</codeline>
<codeline>rel(&lt;);</codeline>
<codeline>out;</codeline>
</pre>

<p>Peut-on également réaliser des trous et plusieurs composants ?</p>

<p>Plusieurs composantes peuvent être réalisées par instruction <em>union</em>.
Car les instructions <em>union</em> peuvent avoir un nombre ad libitum de sous-instructions,
nous pouvons simplement écrire les instructions <em>query</em> pour les composants l'un après l'autre,
ici pour <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.487&amp;lon=0.0&amp;zoom=13&amp;Q=%28%0A%20%20node%28poly%3A%2251%2E47%20%2D0%2E01%2051%2E477%200%2E01%2051%2E484%20%2D0%2E01%22%29%3B%0A%20%20way%28poly%3A%2251%2E47%20%2D0%2E01%2051%2E477%200%2E01%2051%2E484%20%2D0%2E01%22%29%3B%0A%20%20node%28poly%3A%2251%2E491%20%2D0%2E01%2051%2E498%20%2D0%2E03%2051%2E505%20%2D0%2E01%22%29%3B%0A%20%20way%28poly%3A%2251%2E491%20%2D0%2E01%2051%2E498%20%2D0%2E03%2051%2E505%20%2D0%2E01%22%29%3B%0A%29%3B%0Aout%20geom%3B%0Arel%28%3C%29%3B%0Aout%3B">la variante avec <em>nœudes</em> et <em>chemins</em></a>:</p>

<pre>
<codeline>(</codeline>
<codeline>  node(poly:"51.47 -0.01 51.477 0.01 51.484 -0.01");</codeline>
<codeline>  way(poly:"51.47 -0.01 51.477 0.01 51.484 -0.01");</codeline>
<codeline>  node(poly:"51.491 -0.01 51.498 -0.03 51.505 -0.01");</codeline>
<codeline>  way(poly:"51.491 -0.01 51.498 -0.03 51.505 -0.01");</codeline>
<codeline>);</codeline>
<codeline>out geom;</codeline>
<codeline>rel(&lt;);</codeline>
<codeline>out;</codeline>
</pre>

<p>Le contour est spécifié deux fois ici;
cela ne peut être évité pour l'instant.</p>

<p>En conséquence, il pourrait être évident pour les trous,
pour utiliser l'instruction de bloc <a href="../criteria/chaining.html#difference">différence</a>.
Mais ensuite, vous coupez aussi des objets,
en partie dans le trou et en partie dans le polygone environnant,
parce que l'instruction <em>différence</em> trouverait ces objets pertiellement dans le trou.</p>

<p>Au lieu de ça, ça marche,
doubler le point le plus proche du premier point du trou sur la ligne extérieure
et insérez la ligne polygonale avec les points de début et de fin doubles entre eux.</p>

<p>Si, par exemple, nous voulons du triangle <code>51.47 -0.01 51.477 0.01 51.484 -0.01</code>
couper le triangle <code>51.483 -0.0093 51.471 -0.0093 51.477 0.008</code>, alors</p>

<ul>
<li>nous dupliquons d'abord le point le plus proche <code>51.484 -0.01</code>,
a reçu <code>51,47 -0,01 51,477 0,01 51,484 -0,01 51,484 -0,01 -0,01</code></li>
<li>répéter le premier point du trou <code>51.483 -0.0093</code> à la fin,
reçu pour le trou <code>51.483 -0.0093 51.471 -0.0093 51.477 0.008 51.483 -0.0093</code></li>
<li>insérer le trou entre les deux copies du point dupliqué:
<code>51.47 -0.01 51.477 0.01 51.484 -0.01 51.483 -0.0093 51.471 -0.0093 51.477 0.008 51.483 -0.0093 51.484 -0.01</code></li>
</ul>

<p>A titre d'illustration, la <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.477&amp;lon=0.0&amp;zoom=14&amp;Q=node%28poly%3A%2251%2E47%20%2D0%2E01%2051%2E477%200%2E01%2051%2E484%20%2D0%2E01%0A%20%2051%2E483%20%2D0%2E0093%2051%2E471%20%2D0%2E0093%2051%2E477%200%2E008%0A%20%2051%2E483%20%2D0%2E0093%2051%2E484%20%2D0%2E01%22%29%3B%0Aout%20geom%3B">requête terminée pour les nœuds</a>.
Il fonctionne également pour tous les autres types d'objets et peut être combiné avec <em>union</em>,
mais alors vous ne pouvez pas voir la zone réellement sélectionnée par le polygone:</p>

<pre>
<codeline>node(poly:"51.47 -0.01 51.477 0.01 51.484 -0.01</codeline>
<codeline>  51.483 -0.0093 51.471 -0.0093 51.477 0.008</codeline>
<codeline>  51.483 -0.0093 51.484 -0.01");</codeline>
<codeline>out geom;</codeline>
</pre>

<!-- Traduit avec www.DeepL.com/Translator, partiellement redigé -->
<hr/>
<p>prochaine: <a href="area.html">Requêter par surface</a></p>

</body>
</html>
