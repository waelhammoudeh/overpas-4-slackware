<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml">
<head><meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
pre { background-color:#ccffff; padding: 0.5em; counter-reset: line; }
div[type=sibling] { text-indent:1em; }
codeline::before { counter-increment: line; content: counter(line)" "; color: #99cccc; }
</style>
  <title>Plus des criterions</title>
</head>
<body style="font-family:sans-serif; max-width:32em">

<p><a href="../index.html">Mode d'emploi d'API Overpass</a>  </p>

<nav>
<div type="parent"><a href="../preface/index.html">Introduction</a></div>
<div type="parent"><a href="../targets/index.html">Utilisation</a></div>
<div type="parent"><a href="../full_data/index.html">Toutes les données dans une région</a></div>
<div type="parent"><strong><a href="index.html">Trouver des objets</a></strong></div>

<div type="sibling"><a href="nominatim.html">Alternatives</a></div>
<div type="sibling"><a href="per_tag.html">Par Tag</a></div>
<div type="sibling"><a href="chaining.html">Enchainer</a></div>
<div type="sibling"><a href="union.html">Opérations ET et OU</a></div>
<div type="sibling"><a href="lrs.html">Listes de point-vergule</a></div>
<div type="sibling"><strong> Plus des criterions</strong></div>

</nav>
<div type="parent"><a href="../counting/index.html">Compter d'objets</a></div>
<div type="parent"><a href="../analysis/index.html">Analyser des données</a></div>
<div type="parent"><a href="../more_info/index.html">Plus d'informations</a></div>

<hr />

<h1>Plus des criterions</h1>

<p>Encore plus des criterions comme cherchant par longeur, par version d'objet, par nombre d'changeset ou nombre des members.</p>

<nav>
<h3>Sommaire</h3>

<div type="subsection"><a href="misc_criteria.html#per_key">Seulement clés</a></div>
<div type="subsection"><a href="misc_criteria.html#count">Indicateurs d'un objet</a></div>
<div type="subsection"><a href="misc_criteria.html#geom">Chemins par longeur</a></div>
<div type="subsection"><a href="misc_criteria.html#meta">Qualités metas</a></div>
<div type="subsection"><a href="misc_criteria.html#attribution">Attribution</a></div>

</nav>

<p><a name="per_key"/></p>

<h2>Seulement clés</h2>

<p>Il peut être utile,
pour rechercher tous les objets où une certaine <em>clé</em> est définie avec une <em>valeur</em> quelconque.
Un <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.482&amp;lon=-0.0&amp;zoom=17&amp;Q=nwr%5Brailway%5D%28%7B%7Bbbox%7D%7D%29%3B%0Aout%20geom%3B">exemple</a> avec <em>railway</em>:</p>

<pre>
<codeline>nwr[railway]({{bbox}});</codeline>
<codeline>out geom;</codeline>
</pre>

<p>Le filtre <code>[railway]</code> n'autorise que les objets qui portent un attribut <code>railway</code> avec n'importe quelle valeur.
Ici, il est combiné avec un filtre <code>({{bbox}})</code>,
pour que l'on puisse trouver exactement ces objets,
qui ont à la fois un attribut avec clé <code>railway</code>
ainsi que sont situés dans le rectangle englobant transmise par Overpass Turbo.</p>

<p>Toute clé peut être utilisée comme condition de filtrage en utilisant des crochets.
Les clés dont le nom contient un caractère spécial doivent être <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.482&amp;lon=-0.0&amp;zoom=17&amp;Q=nwr%5B%22addr%3Ahousenumber%22%5D%28%7B%7Bbbox%7D%7D%29%3B%0Aout%20geom%3B">mises entre guillemets</a>:</p>

<pre>
<codeline>nwr["addr:housenumber"]({{bbox}});</codeline>
<codeline>out geom;</codeline>
</pre>

<p>En principe, les filtres par clés peuvent également être utilisés comme seul filtre dans une instruction <em>query</em>.
Cependant, il n'y a guère de cas d'utilisation significative uniquement en termes de quantité de données et de durée de recherche.</p>

<p>Plusieurs de ces filtres peuvent également <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.482&amp;lon=-0.0&amp;zoom=17&amp;Q=nwr%5B%22addr%3Ahousenumber%22%5D%5B%22addr%3Astreet%22%5D%28%7B%7Bbbox%7D%7D%29%3B%0Aout%20geom%3B">être combinés</a>:</p>

<pre>
<codeline>nwr["addr:housenumber"]["addr:street"]({{bbox}});</codeline>
<codeline>out geom;</codeline>
</pre>

<p>Ici, nous ne nous intéressons qu'aux objets,
qui ont à la fois un numéro de maison et un nom de rue pour l'adresse.
L'instruction <em>query</em> de la ligne 1 sélectionne exactement ces objets,
qui ont un attribut avec la clé <code>addr:housenumber</code> et en plus un attribut avec la clé <code>addr:street</code>.</p>

<p>Puisqu'il est également possible d'mettre en négation la condition,
il est également possible de rechercher de cette façon les objets qui doivent être traités.
Nous recherchons des objets qui <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.482&amp;lon=-0.0&amp;zoom=15&amp;Q=nwr%5B%22addr%3Ahousenumber%22%5D%5B%21%22addr%3Astreet%22%5D%28%7B%7Bbbox%7D%7D%29%3B%0Aout%20geom%3B">portent</a> un attribut avec la clé <code>addr:housenumber</code> mais pas d'attribut à la clé <code>addr:street</code>:</p>

<pre>
<codeline>nwr["addr:housenumber"][!"addr:street"]({{bbox}});</codeline>
<codeline>out geom;</codeline>
</pre>

<p>La négation se fait par un point d'exclamation entre le crochet d'ouverture et le début de la clé.</p>

<p><a name="count"/></p>

<h2>Indicateurs d'un objet</h2>

<p>Les filtres qui peuvent être utilisés pour compter les objets,
ne peut être utilisé qu'en combinaison avec d'autres filtres.
La raison en est que les volumes de données à traiter autrement deviennent rapidement incontrôlables.</p>

<p>Pour compter les attributs d'un objet, il faut mentionner ici les deux applications les plus populaires,
pour tous les autres, veuillez vous référer au chapitre <a href="../counting/index.html">Compter des objets</a>.</p>

<p>Il est possible de sélectionner tous les objets qui ont au moins un attribut.
Ici <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.482&amp;lon=-0.0&amp;zoom=17&amp;Q=node%28if%3Acount%5Ftags%28%29%3E0%29%28%7B%7Bbbox%7D%7D%29%3B%0Aout%20geom%3B">pour les noeuds</a>, puisque presque tous les chemins et relations portent des attributs de toute façon:</p>

<pre>
<codeline>node(if:count_tags()&gt;0)({{bbox}});</codeline>
<codeline>out geom;</codeline>
</pre>

<p>Inversement, il est également possible de sélectionner tous les objets qui ne portent pas des attributs.
Ici <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.482&amp;lon=-0.0&amp;zoom=15&amp;Q=way%28if%3Acount%5Ftags%28%29%3D%3D0%29%28%7B%7Bbbox%7D%7D%29%3B%0Aout%20geom%3B">pour chemins</a>:</p>

<pre>
<codeline>way(if:count_tags()==0)({{bbox}});</codeline>
<codeline>out geom;</codeline>
</pre>

<p>Cependant, les deux requêtes sont moins utiles qu'elles n'en ont l'air:
D'une part, il y a des attributs non informatives
(<code>created_by</code> sur <em>nœuds</em>, <em>chemins</em> ou <em>relations</em> est désapprouvé, mais pourrait bien exister encore)
d'autre part, les objets peuvent appartenir à des relations.</p>

<p>Pour les <em>chemins</em> et <em>relations</em>, le nombre de membres peut être compté, calculé et comparé.
Vous trouverez également des exemples complets dans le chapitre <a href="../counting/index.html">Compter des objets</a>.</p>

<p>Nous pouvons trouver des <em>chemins</em> <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.482&amp;lon=-0.0&amp;zoom=15&amp;Q=way%28if%3Acount%5Fmembers%28%29%3E200%29%28%7B%7Bbbox%7D%7D%29%3B%0Aout%20geom%3B">avec un nombre particulièrement important de membres</a>:</p>

<pre>
<codeline>way(if:count_members()&gt;200)({{bbox}});</codeline>
<codeline>out geom;</codeline>
</pre>

<p>Ou vérifiez les relations pour voir si tous les membres ont des rôles plausibles.
Pour cela, nous utilisons l'évaluateur <code>count_by_role</code> en plus de l'évaluateur <code>count_members</code>,
pour l'<a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.482&amp;lon=-0.0&amp;zoom=12&amp;Q=rel%5Btype%3Drestriction%5D%28%7B%7Bbbox%7D%7D%29%0A%20%20%28if%3Acount%5Fmembers%28%29%0A%20%20%20%20%2Dcount%5Fby%5Frole%28%22from%22%29%0A%20%20%20%20%2Dcount%5Fby%5Frole%28%22to%22%29%0A%20%20%20%20%2Dcount%5Fby%5Frole%28%22via%22%29%20%3E%200%29%3B%0Aout%20center%3B">indiquer</a> pour les restrictions de tourner:</p>

<pre>
<codeline>rel[type=restriction]({{bbox}})</codeline>
<codeline>  (if:count_members()</codeline>
<codeline>    -count_by_role("from")</codeline>
<codeline>    -count_by_role("to")</codeline>
<codeline>    -count_by_role("via") &gt; 0);</codeline>
<codeline>out center;</codeline>
</pre>

<p>Ce ne sont pas de vraies erreurs:
comme mentionné explicitement dans tous les diagnostics et dans le chapitre <a href="../analysis/index.html">Analyser des données</a>,
les objets ayant des propriétés inattendues sont le début d'une recherche, et non sa fin.</p>

<p><a name="geom"/></p>

<h2>Chemins par longeur</h2>

<p>Il est possible de déterminer la longueur d'un chemin ou d'une relation via l'évaluateur.
Outre les <a href="../counting/index.html">évaluations statistiques</a>, cela permet également
de selectionner chemins ou relations par leur longueur.
La longueur est toujours affichée en mètres.</p>

<p>Un exemple utilisé pour l'assurance qualité ont été les cheminées,
parce que l'attribut <code>building=chimney</code> associé a été occasionnellement utilisé pour l'ensemble du bâtiment industriel.
C'est pourquoi nous recherchons dans le monde entier toutes les cheminées <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=30.0&amp;lon=-0.0&amp;zoom=1&amp;Q=way%5Bbuilding%3Dchimney%5D%28if%3Alength%28%29%3E62%29%3B%0Aout%20geom%3B">d'une circonférence de plus de 62 mètres</a>:</p>

<pre>
<codeline>way[building=chimney](if:length()&gt;62);</codeline>
<codeline>out geom;</codeline>
</pre>

<p>Il serait également évident de vouloir trouver de longues rues.
Mais comme les rues sont généralement composées de plusieurs sections,
nous devons d'abord regrouper les rues à nouveau.
Les requêtes de ce degré de complexité appartiennent plutôt au chapitre <a href="../analysis/index.html">Analyser des données</a>,
mais pour plus de commodité, une approche d'une longueur minimale de 2 km <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.482&amp;lon=-0.0&amp;zoom=14&amp;Q=%5Bout%3Acsv%28length%2Cname%29%5D%3B%0Away%5Bhighway%5D%5Bname%5D%28%7B%7Bbbox%7D%7D%29%3B%0Afor%20%28t%5B%22name%22%5D%29%0A%7B%0A%20%20make%20stat%20length%3Dsum%28length%28%29%29%2Cname%3D%5F%2Eval%3B%0A%20%20if%20%28u%28t%5B%22length%22%5D%29%20%3E%202000%29%0A%20%20%7B%0A%20%20%20%20out%3B%0A%20%20%7D%0A%7D">est esquissée</a> ici:</p>

<pre>
<codeline>[out:csv(length,name)];</codeline>
<codeline>way[highway][name]({{bbox}});</codeline>
<codeline>for (t["name"])</codeline>
<codeline>{</codeline>
<codeline>  make stat length=sum(length()),name=_.val;</codeline>
<codeline>  if (u(t["length"]) &gt; 2000)</codeline>
<codeline>  {</codeline>
<codeline>    out;</codeline>
<codeline>  }</codeline>
<codeline>}</codeline>
</pre>

<p>Les lignes 3 à 10 sont une boucle,
dans laquelle la sélection de la ligne 2, à savoir toutes les voies avec les clés <code>highway</code> und <code>name</code>
être regroupées après <code>name</code>.
Pour cette raison, on peut utiliser l'expression <code>sum(length())</code> à la ligne 5 pour totaliser la longueur de tous les objets d'un même nom.
Dans les lignes 6 à 9, nous n'écrivons alors une sortie que si la longueur atteinte dépasse 2000 mètres.</p>

<p>Une approche qui indique aussi quelque chose est difficile,
puisque chaque nom est représenté par de nombreux objets.
Une solution utilisant les <em>deriveds</em> est également présentée dans le chapitre <a href="../analysis/index.html">Analyser des données</a>.</p>

<p><a name="meta"/></p>

<h2>Qualités metas</h2>

<p>Il est possible de rechercher un objet directement par type et id,
<a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.478&amp;lon=-0.0&amp;zoom=17&amp;Q=node%281%29%3B%0Aout%3B">ici le nœud 1</a>:</p>

<pre>
<codeline>node(1);</codeline>
<codeline>out;</codeline>
</pre>

<p>A cet effet, le filtre <code>(...)</code> avec l'identifiant entre les parenthèses montré ici sont disponibles,
et en plus les évaluateurs <code>id()</code> et <code>type()</code>.
Les cas d'utilisation directe ne me sont pas connus,
mais certaines fonctions importantes d'<a href="../analysis/index.html">analyse des données</a> utilisent cette fonctionnalité.</p>

<p>En revanche, seulement un évaluateur est disponible pour la version d'un objet,
parce qu'un filtre seul conduirait à des quantités folles de données de toute façon.</p>

<p>Un cas d'utilisation populaire est d'identifier les imports absurdes ou illégaux.
Pour ce faire, il peut être utile <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.478&amp;lon=-0.0&amp;zoom=17&amp;Q=nwr%28%7B%7Bbbox%7D%7D%29%0A%20%20%28if%3Aversion%28%29%3D%3D1%29%3B%0Aout%20center%3B">de sélectionner</a> tous les objets de la version 1 dans un rectangle englobant:</p>

<pre>
<codeline>nwr({{bbox}})</codeline>
<codeline>  (if:version()==1);</codeline>
<codeline>out center;</codeline>
</pre>

<p>Pour ce faire, l'évaluateur <code>version()</code> est utilisé ici à la ligne 2.
Comme pour tous les <em>évaluateurs</em> utilisés comme <em>filtres</em>, cela se fait,
en comparant la valeur de l'<em>évaulateur</em> avec une autre valeur (ici 1) dans le cadre du filtre <code>(if:...)</code>.</p>

<p>Pour les horodatages, il y a aussi essentiellement un évaluateur disponible, à savoir <code>timestamp()</code>.
Il existe en effet un filtre <code>(changed:...)</code>,
mais celui-ci est destiné à être utilisé <a href="../analysis/index.html">avec des données expirées</a>.</p>

<p>L'évaluateur <code>timestamp()</code> retourne toujours une date dans <a target="_blank" rel="noopener" href="https://fr.wikipedia.org/wiki/ISO_8601">le format de date international</a>,
p. ex. <code>2012-09-13</code> pour le 13 septembre 2012.
Elle doit donc toujours être comparée à une date au format ISO.
Par exemple, nous énumérons tous les objets qui ont été modifiés pour la dernière fois près de Greenwich <a target="_blank" rel="noopener" href="https://overpass-turbo.eu/?lat=51.478&amp;lon=-0.0&amp;zoom=16&amp;Q=nwr%28%7B%7Bbbox%7D%7D%29%28if%3Atimestamp%28%29%3C%222012%2D09%2D13%22%29%3B%0Aout%20geom%28%7B%7Bbbox%7D%7D%29%3B">avant le 13 septembre 2012</a>:</p>

<pre>
<codeline>nwr({{bbox}})(if:timestamp()&lt;"2012-09-13");</codeline>
<codeline>out geom({{bbox}});</codeline>
</pre>

<p>Quelques pièges sont à retenir:</p>

<ul>
<li>Les <em>chemins</em> et <em>relations</em> peuvent modifier leur géométrie sans créer une nouvelle version,
c'est-à-dire si seuls les <em>nœuds</em> référencés ont été déplacés sans modifier le référencement.</li>
<li>La plupart des propriétés d'un objet proviennent de versions antérieures,
c'est-à-dire qu'une date de modification apparemment récente ne signifie pas nécessairement un objet actuel.</li>
</ul>

<p><a name="attribution"/></p>

<h2>Attribution</h2>

<p>...</p>
<hr/>
<p>prochaine: <a href="../counting/index.html">Compter d'objets</a></p>

</body>
</html>
