
This is the "README.data" file for overpass Slackware package.

IMPOTRANT: This is work in progress, may also have inacurate information.
WARNING: Database initialization can be time consuming process.

The "data" is the subject in this file; the data inside the overpass database.
Here you will find the source; where and what to get for your database, the
destination for it (where to store it), how to initial the database with that data
and finally how to make it available for use on your machine (setup). The
data is OpenStreetMap (OSM) data.

Terminology:  meta, attic and change-set.

Meta: extra information such as objects versions, timestamps (create, change)
and the editing user information (ids and other things). Data files with "meta"
can have full or partial extra information.

Attic: attic data is historical data, things change, street names even city name
can change (Bombay to Mumbai, India), other things may change in the database.
Quoting from overpassAPI installation: "Since Overpass API v0.7.50, it is possible
to also retain previous object versions, the so called attic versions, in the
database. Previous object versions are accessible via [date:...], [diff:...],
[adiff:...] as well as some filters like (changed:...)." end quote.

Change-set: Objects have tags which might changed or new tag gets added, the
changes in current release OSM file from the previous release is the change-set.
Change-sets files are small and can be used to updated previous OSM file and
databases with OSM data.
The change-set is between two immediate releases. If your OSM file has three
releases since you downloaded, you need all three change-sets to update it to
the current release.

Populate (initial) database in 2 different ways:
The first is to use the "download_clone.sh" script provided with overpassAPI
source (find it in /usr/local/bin if you install using my SlackBuild script).
I have not tried this method, I do not mean to bash the script and I do really
appreciate that it is available. The script is easy way to clone the WHOLE
database from the server, no partial option. You may choose without attic or
meta data, but you still get the whole planet data.
I do not know the acctual size of the database - has to be in the 100s of GBs.
I do know that I do not have the hard disk space on my machine for it. I also
do not want to guess how long it will take to download or think of how to ensure
the integrity of the data. Please see the complete installation page (in the html
directory of the package) for "download_clone.sh" usage. If you have the hard
disk space and good (fast) internet connection then this is the way to take.

The second method to initial the database is from data file from OpenStreetMap.
We use this method to save hard disk space, I do not have one terabyte free.
The OSM data file can be for planet or smaller areas. They are available for
regions divided by countries, continents or even smaller areas like cities.
This is the method I chose for myself and describe here. You have total control
of what to include in your database.
Warning: this process can take a long time.

OSM data files formats:

The data used in overpass database is "Open Street Maps" data, the same data
used to draw the map. OSM data files tend to be huge resulting in big database.
OSM data files come in different types, overpass requires the file to initial
the database to be OSM XML bzip2-compressed format - ends with suffix .bz2.
Your source file may not be available in this format, do not worry you can
convert it to this required format.
The OSM "osmium command line tool" is used to convert between file types among
other functions on OSM files. I have a SlackBuild script for the tool on my
repository that you may need:

https://github.com/waelhammoudeh/osmium-tool_slackbuild

With osmium you may download a file with say "PBF" format then convert it to
bz2 format. For example this was exactly what I did, my source was in "pbf" and
I had to convert it with the following command:

 $ osmium cat arizona-internal.osh.pbf -o arizona-internal.osh.bz2

note that -o switch specifies output file name and from its suffix "osmium"
will figure out the format for output. See the man page for osmium. This
operation can take some time depending on file size, processor and amount
of memory on the machine. Mine run for about 10 minutes to finish.
Another note; YOU NEED THE HISTORY FILE TO HAVE ATTIC DATA
".osh.bz2".Just make sure the file format is compressed bz2.

OSM data files may or may not include "META" data (see Terminology above). Yes
you can save disk space without meta data, but your query results will not be
accurate, I would also argue that the query result is wrong. In short meta data
can include essential information. You can query overpass using other programs
such as JSOM; which requires meta data.
As for the attic data - previous objects and history - those enable more query
functions, or the lack of them disables those extra functions if you well. We
do not want to comprmise on this, I may limit the area to save disk space but I
still want full query functions.
In short choose a data file with attic (history) and meta data.

Data source for downloads:

There are a lot of web sites that provide OSM data files (or extracts), they are
not all the same in terms of organization and ease of use. One web site I found
and recommand is this one: { https://download.geofabrik.de/ } for those reasons:

Simple UI with continent, regional and country files.
Map in upper-right corner
file size listing with full meta and attic data, provide changesets
osh vs osm : historical (attic) data.
read technical details page.

Please note that this site has two servers with two sets of files! You need to
have an account with OpenStreetMap to get to the set with complete data files.
So please first register with OpenStreetMap and then start with this URL:

        {  https://osm-internal.download.geofabrik.de/index.html  }

for your data file download.

Check this wiki page for info about extracts and data types URL:

 { https://wiki.openstreetmap.org/wiki/Planet.osm }

Pay attention to the file size you choose, that size is NOT for your database!
It is obviously related to your final database size. My original download size
for "arizona-internal.osh.pbf" was about 319 MB, when converted to bz2
"arizona-internal.osh.bz2" it got bigger to 521 MB and my database after I
did the initialization to it was 19 GB with meta data and 33 GB with attic data.

Before you download a file, read the description for the file on the website.
You need your file to have meta data and history. Also check how often files
are released. Some sites may offer change-set release and some do not. Is that
important to you?


Database home - storage:

Where you store the database is the overpass user home directory we used
when created the overpass group and user. If you need to make any changes to
that, now is the time before you initial the database.

At this point you need to decide where to store the database. Store the database
on SSD (Solid State Drive) if you have one, or your fast hard drive, the faster
the drive the less time for the query result since there will be a lot of file I/O.
You need to make sure you have enough space for the database. I can not till
you how much since it depends on your area. Data files vary wildly in size for
countries and regions, hence it is hard to tell the required disk space.

Here are few numbers I have that may help:

  file name                                 file size      Database size (attic)
-----------------------------------------------------------------------------
arizona-internal.osh.bz2        521 MB           33 GB
us-west-internal.osh.bz2        6266 MB        95 GB

That database size was the final size, during the initial step you need TWICE of
that size of free disk space!
Also keep in mind files were originally in .pbf format with 318 MB and 4075 MB
sizes respectively.
I recommand at least 70 GB free disk space for small (about 500 MB) data
file source.



[TO BE CONTINUED]

TO DO:
overpass user initials DB ...
setup rc.dispatcher ...

   Before leaving this section, we are going to make our decisions / assumptions
   as follow:
     - Store database under /home directory since there is enough disk space,
       so we make a directory as root with the name of "overpass";
       # mkdir /home/overpass
       I will refer to the /home part of the path above as {DB_ROOT}, so place
       your database directory anywhere you want.
     - The input file I will use has meta data with the name "infile.osm.bz2"

C) Initial The Data Base:
   With the above assumptions we initial the data base using "init_osm3s.sh"

   script usage is:
   init_osm3s.sh infile $DBDIR $EXECDIR [option]

   option is one of:
   empty - nothing --> database without meta data.
   --meta --> database with meta data
   --keep-attic --> database with meta data plus attic

   $ /usr/local/bin/init_osm3s.sh inputfile.bz2 "/home/overpass/" "/usr/local/" --meta &

   provided with the software; this script takes three arguments and one
   command option as follows:
   1) infile: is the input file; has to be of type .osm.bz2
   2) data base directory: where to store the data base - destination
   3) executable directory: this is the bin directory root where overpass is
      installed - /usr/local/ without the bin entery.
   4) the meta option: The presence of "--meta" option will result in database
        with metadata and the absence of the option will result in database
        without metadata. If option is set to --keep-attic then database will
        have metadata plus attic data.

   Do the following to initial data base:
   - As root user change user to overpass with:
     root@lazyant:~# su overpass <enter>

   - Then your prompt should look like this on your terminal:
     overpass@lazyant:/root$

     And whoami and its output should look like:
     overpass@lazyant:/root$ whoami
     overpass

     Assuming everything is good; change directory to where you placed your
     "infile.osm.bz2" and initial the data base with:

     overpass@lazyant:/root$ nohup /usr/local/bin/init_osm3s.sh infile.osm.bz2 "{DB_ROOT}/overpass/" "/usr/local/" --meta &

     You need full path for the script: /usr/local/bin/init_osm3s.sh above.
     Replace {DB_ROOT} above with your real path.

     My actual infile.osm.bz2 was "arizona-latest-internal.osm.bz2" for the
     state of Arizona with file size about 300 MB, on my machine the above
     command to initial the data base took about 32 minutes, with directory
     size about about 19 GB. YMMV! (Was 17 GB for source data file from 2 years ago)

   With those steps so far, you can query your data base on the command line.
   Using the example file provided with this README; and please replace with
   good points from your database input file:

     $ osm3s_query --db-dir={DB_ROOT}/overpass < example

   above assumes you are in the directory where the example file is.

Data base updates will not be covered here. See documentation in your
installation for that, or check online :)

Dispatcher has modes related to meta, no meta and attic .....
The "dispatcher" program is part of the overpass package, it is the daemon
which forwards queries to the correct part of the package. As long as the
dispatcher is running, your queries to overpass will be answered.
